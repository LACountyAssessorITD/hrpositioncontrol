<!DOCTYPE html>
<html>
<head>
  <title>Home | HR Position Control</title>
  <link rel="stylesheet" href="css/landing.css">
</head>
<body>
  <div id="outercontainer2">
    <button id="btn-extrac">New</button>
    <div id="outercontainer1">
      <h1>LA County Assessor<br> HR Position Control</h1>
      <label class="custom-select" for="selectVersion">
        <select id="selectVersion">
          <option value="">
            Select an version
          </option>
        </select>
      </label>
      <button id="btn-open">Open</button>
      <button id="btn-delete">Delete</button><br>
      <label>Note: Please use Chrome for best results.</label>
    </div>
  </div>
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script type="text/javascript">
  $(document).ready(function(){

    var versions;
    $.ajax({
      url: "php/pick_version.php",
      data: null,
      type: 'POST',
      dataType: "json",
      success: function(output) {
        console.log ('getversion output:' + output);
        versions = output;
      },
      error: function(xhr, status, error){
        alert ('error: ' + error + '; status=' + status);
      },
      async:false
    });

    var dropdown = document.getElementById("selectVersion");
    for (var i=0;i<versions.length; i++){
      var time = versions[i]['time'].toString().trim();
      var d = new Date(time);
      var hh = d.getHours();
      var m = d.getMinutes();
      var s = d.getSeconds();
      var dd = "AM";
      var h = hh;
      if (h >= 12) {
        h = hh - 12;
        dd = "PM";
      }
      if (h == 0) {
        h = 12;
      }
      m = m < 10 ? "0" + m : m;
      s = s < 10 ? "0" + s : s;
      // Note: getMonth returns values [0-11]
      var formatedTime = d.getMonth()+1 + "-" + d.getDate() + "-" + d.getFullYear() + " "
        + h + ":" + m + ":" + s + " " + dd;

      var version_name = versions[i]['version_name'].toString().trim();
      var owner = versions[i]['user'].toString().trim();
      var version_id = versions[i]['version_id'];
      var option = document.createElement("option");
      // option.text =  time+ ' '+ version_name + ' '+ owner;
      // option.value = version_name;
      option.text = 'Version #' + version_id + ' last modified on ' + formatedTime;
      option.value = version_id;
      dropdown.append(option);
    }

    // change listener for select head drop-down list
    // $('#selectVersion').on('change', function() {
    //    var version_id = document.getElementById("selectVersion").value;
    //    sessionStorage.setItem("sent", version_id);
    //    window.open("http://localhost/hrpositioncontrol/OrgChart-master/demo/lacounty.html","_blank");
    // });

$('#btn-extrac').on('click', function() {
  if (sessionStorage.getItem("sent")) {
    sessionStorage.removeItem("sent");
  }
  window.open("http://localhost/hrpositioncontrol/OrgChart-master/demo/lacounty.html","_self");
});
$('#btn-open').on('click', function() {
  var version_id = document.getElementById("selectVersion").value;
  sessionStorage.setItem("sent", version_id);
  window.open("http://localhost/hrpositioncontrol/OrgChart-master/demo/lacounty.html","_self");
});

$('#btn-delete').on('click', function() {
  var result = confirm("Are you sure you want to delete the selected version?");
  if (result == true) {
    var version_id = document.getElementById("selectVersion").value;
    var x = document.getElementById("selectVersion");
    x.remove(x.selectedIndex);
    var myData = {
      'version_id': version_id
    };
    $.ajax({
      url: "php/delete_version.php",
      data: myData,
      type: 'POST',
      dataType: "text",
      success: function(output) {

      },
      error: function(xhr, status, error){
        alert ('error: ' + error + '; status=' + status);
      },
      async:false
    });
  }
});

});
</script>

</body>
</html>
